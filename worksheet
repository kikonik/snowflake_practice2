CREATE DATABASE RHINO_PART_INVENTORY_DB;

CREATE SCHEMA RHINO_PART_INVENTORY_DB.INVENTORIES_SCHEMA;

CREATE SCHEMA RHINO_PART_INVENTORY_DB.INVENTORY_SETS_SCHEMA;

CREATE SCHEMA RHINO_PART_INVENTORY_DB.INVENTORIES_PARTS_SCHEMA;

CREATE SCHEMA RHINO_PART_INVENTORY_DB.PARTS_SCHEMA;

CREATE SCHEMA RHINO_PART_INVENTORY_DB.PART_CATEGORIES_SCHEMA;

CREATE SCHEMA RHINO_PART_INVENTORY_DB.COLORS_SCHEMA;

CREATE SCHEMA RHINO_PART_INVENTORY_DB.SETS_SCHEMA;

CREATE SCHEMA RHINO_PART_INVENTORY_DB.THEMES_SCHEMA;

CREATE SCHEMA RHINO_PART_INVENTORY_DB.STAGE_DATA;

USE SCHEMA STAGE_DATA;

CREATE STAGE UPLOAD_DATA;

USE SCHEMA RHINO_PART_INVENTORY_DB.COLORS_SCHEMA;

CREATE OR REPLACE TEMP TABLE RHINO_PART_INVENTORY_DB.COLORS_SCHEMA.tmp_colors
AS 
SELECT 
$1 AS id,			
$2 AS name,
$3 AS rgb,
$4 AS is_trans,

FROM @STAGE_DATA.upload_data/colors.csv;

CREATE OR REPLACE TEMP TABLE RHINO_PART_INVENTORY_DB.COLORS_SCHEMA.trans_td
AS 
SELECT 
$1 AS id,			
$2 AS name,
$3 AS rgb

FROM RHINO_PART_INVENTORY_DB.COLORS_SCHEMA.tmp_colors
WHERE is_trans='t';

SELECT * FROM RHINO_PART_INVENTORY_DB.COLORS_SCHEMA.trans_td;

CREATE OR REPLACE TEMP TABLE RHINO_PART_INVENTORY_DB.THEMES_SCHEMA.tmp_top_themes_this_month 
AS 
SELECT 
$2 AS theme

FROM @STAGE_DATA.upload_data/themes.csv;

CREATE OR REPLACE TABLE RHINO_PART_INVENTORY_DB.THEMES_SCHEMA.td_top_themes_this_month (

theme VARCHAR,			
count INT
);

SELECT COUNT(CASE WHEN theme = 'STAR WARS') AS themes
FROM RHINO_PART_INVENTORY_DB.THEMES_SCHEMA.tmp_top_themes_this_month;

INSERT INTO RHINO_PART_INVENTORY_DB.THEMES_SCHEMA.td_top_themes_this_month (theme)
    VALUES ( (SELECT COUNT(tblB.ID) FROM tblB) );
